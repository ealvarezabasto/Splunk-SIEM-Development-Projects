# Universal Forwarder (agent)
**Description:** agent that collects data from a server and send it to Splunkk

## Installing Universal Forwarder to a brand new server
* Go to: https://www.splunk.com/en_us/download.html > 'Get my Free Donwload' for Universal Forwarder

  ![image](https://github.com/user-attachments/assets/9e2df28d-256a-4bc4-83a0-664a6f6c87ba)

* Select 64-bit > .deb for 'Ubuntu Linux Server' > copy the wget link for .deb

  ![image](https://github.com/user-attachments/assets/c4d2efe4-e08b-4879-8c14-daf9ef548934)

* Within Command Line, type root@157.230.11.23 (Splunk Public IP Address) > paste the wget link

  ![image](https://github.com/user-attachments/assets/db9655d2-e053-459a-a15a-51f11d174ce8)

* Type **ls** and you will find .deb file that was recently downloaded. Type **dpkg -i --.deb file--**

  ![image](https://github.com/user-attachments/assets/acc0e7be-838a-4978-9dcc-f85e4cfbb0c4)

* Type **cd /opt/splunkforwarder**. Type **cd bin** to access bin directory for Universal Forwarder. Type **ls** to view all sub-directories.

  <img width="855" alt="image" src="https://github.com/user-attachments/assets/bd756b16-6fac-4d61-bf8c-f0508c1b8bf5" />

* Type **./splunk start**. Type **./splunk status**, should now reflect Splunk Forwarder is running.

  ![image](https://github.com/user-attachments/assets/4d0aa60f-f0ab-4261-baef-951587fa00b8)

* Type **./splunk list monitor** to see log files that the Splunk forwarder would be sending.
* These are the directories that are currently being monitored; however, you see that no system level logs are being monitored. When you connect this Splunk forwarder to the Splunk index, there are certain log files that needs to be sent. You can determine which are the log files that you want to be indexed. 

  ![image](https://github.com/user-attachments/assets/6f7488e0-b1ec-4295-a955-4d5665c45a70)

* For the logs to be sent from the Universal Forwarder, there needs to be a receiving port at the Splunk site (Port 9997).
* Select ***Settings*** > **Forwarding & Receiving** > **Configure Receiving**
  
  ![image](https://github.com/user-attachments/assets/c2af05ee-2aa1-4829-84b5-de1b2121be5c)

  ![image](https://github.com/user-attachments/assets/854a4daf-921c-496c-9036-c20dd30032c6)

* Select **New Receiving Port**

  ![image](https://github.com/user-attachments/assets/4dedbe10-649d-4538-a592-597a8fe3c0d1)

* Type Splunk Receiving Port of 9997

  ![image](https://github.com/user-attachments/assets/aa200420-a262-4d73-966f-d77edc50cd29)

* Port of 9997 created

  ![image](https://github.com/user-attachments/assets/39e29b3a-8c73-4ab5-9ae5-468b97c498cd)

## Test that connection is successful between Server's Universal Forwarder and Splunk Instance (Port 9997)

* To identify if there is connectivity between Universal Forwarder and Splunk instance, within Command LIne type **telnet 157.230.11.23 9997** (157.230.11.23 is the IP address of the Splunk Instance and 9997 is the port number of the Splunk Instance)

  ![image](https://github.com/user-attachments/assets/19756276-aefc-4a9e-9550-a2ecbadb8795)

## Monitor the appropriate log files that are sent to Splunk.

* By typing **ls -l /var/log**, you can see the list of logs that are stored in the var/log directory

* We need to make sure that these logs are being sent to the central Splunk instance. How to do this?

  <img width="722" alt="image" src="https://github.com/user-attachments/assets/f1d50433-c823-44b6-920c-fc23ff6d2c26" />

* You need to specify to the Splunk forwarder that you want to send the system logs to Splunk Instance. To do this, type **/opt/splunkforwarder/bin/splunk add monitor /var/log**. This directory of /var/log is now being monitored. Now we have told the Universal Forwarder to monitor the content of var/log directory. 

  <img width="518" alt="image" src="https://github.com/user-attachments/assets/f32a1c58-ec57-4ec4-8d2f-f26ef6e057a7" />

* But at this stage we have not yet told the forwarder the address of the splunk instance where the data needs to be sent.

## Tell Universal Forwarder where is the Splunk Instance (Port 9997) for it to send data (log files) to.
* Type **/opt/splunkforwarder/bins/plunk add forward-server** add server where the data needs to be forwarded to so we need to specify the IP address of the Splunk instance + port number 9997.

  ![image](https://github.com/user-attachments/assets/788ae50b-78e3-405c-93f2-d1045edfe01f)

## Successfully logs are sent to Splunk Instance (Port 9997)
* Within Splunk instance, view the various logs that are successfully being sent from the var/log directory.

  ![image](https://github.com/user-attachments/assets/fa87e41c-a2ed-4e0d-99b0-8d1341b6eac9)

# Automation

## Option 1: Configuration Management TOols
* Doing the above process is tideous if having to send data from multiple servers unto Splunk instance. In order to not have to take these manual steps, there are configuration managements tools (e.g., Ansible) that can automate this proccess.
* What you do is add the below commands (that were manually used in the above steps) into the Ansible playbook for it to run automatically in those servers.

  **./splunk add monitor /var/log**
  **./splunk add forward-server 172.17.0.2:9997**

## Option 2: Splunk Forwarder Management
* Connect all forwarders to central Splunk Forwarder Management
* Splunk Forwarder Management would be configured for the following use-case examples:
  * Any server which belongs to subnet 192.168.10.0/24 network should have only /var/log/scure file to be monitored.
  * Any server which belongs to subnet 10.77.0.0/20 should have /var/log/secure and /var/log/audit directory to be monitored.
  * If server hostname starts with win-, then integrate it to send all the windows events and AD logs.

  ![image](https://github.com/user-attachments/assets/01c371db-4c6b-4704-a062-0d418b619c19)

# Forwarder Management vs. Deployment Server vs. Deployment App vs. Server Class
* **Deployment Server:** Primarily used to manage and deploy configurations and apps to multiple Splunk instances, particularly forwarders. Ideal for organizations with a large number of forwarders that need to be managed centrally, ensuring that all forwarders have the same configurations and apps. Ideal for organizations with a large number of forwarders that need to be managed centrally, ensuring that all forwarders have the same configurations and apps.
* **[UI] Splunk Forwarder Management:** GUI built on top of deployement Server that provides an easy way to configure the deployemnt server and monitor the staus of deployment updates. Forwarder Management is a feature within Splunk that focuses on monitoring and managing the status and health of Splunk forwarders. It provides visibility into the performance and status of forwarders, including their connectivity, data transmission rates, and any issues that may arise. It helps in troubleshooting and ensuring that data is being forwarded correctly.
* **Deployment App:** A set of content (e.g., configuraiton files) maintained by deployment server and pushed to the deployment clients belong to a specific server class. **Example:** 1 Deployment appp has inputs.conf which monitors for /var/log/secure and /var/log/aduit. This deployment app is associated with "Linux" server class.
* **server class:** group that contains multiple deployment apps
  
# Forwarder Management / Deployment Server / Deployment App

**Note:** The forwarder management UI distributes deployment apps to Splunk clients.

* Within Command Line for Splunk Instance, type **/opt/splunk/etc ls -l** and find 'deployment-apps'

* type **cp -R app/sample_app/ deployemnt-apps** to copy sample_app to deployment-apps. Type **/opt/splunk/bin/splunk restart** to restart Splunk instance.

  ![image](https://github.com/user-attachments/assets/14bb338a-3583-46cb-b98f-f3c1096c4614)

* Within Splunk ES, find 'sample_app' within Splunk FOrwarder Management GUI.

  ![image](https://github.com/user-attachments/assets/993a88a7-f701-4450-834f-45e7b9496b1d)


  ![image](https://github.com/user-attachments/assets/24ef5652-68d1-4503-acd1-94117708be0b)

* Click Settings > Forwarder Management. You can see ***sample_app*** that is the deployment app.

  ![image](https://github.com/user-attachments/assets/676e558d-64e0-410f-93b9-189a0534ccf1)

# Server Class

* Within 'Forwarder Management' > 'Group / Server Classes' tab ? + 'new Server Class'

  ![image](https://github.com/user-attachments/assets/c276ea9e-e406-4e03-8e05-8b7b0accf4b4)

* Name new server class

  ![image](https://github.com/user-attachments/assets/3020d34e-9cfa-4551-93f0-dfd5ff8867f9)

* Within recently created server class, select on 'edit configurations'.

  ![image](https://github.com/user-attachments/assets/7d5e23eb-1328-49cf-aa21-ce0e54c57259)

* Add * to 'Include'

  ![image](https://github.com/user-attachments/assets/a43418ff-b6d5-4d9f-863c-b26ecfa4aec9)

* Within recently created server class, select on Configurations tab > 'edit configurations'.

  ![image](https://github.com/user-attachments/assets/9106b901-a69f-48bc-8b03-745a66cef2d5)

* add the sample_app and select 'Save'

  ![image](https://github.com/user-attachments/assets/2b9a8794-5c9f-4e23-9b9f-8c49aded8d3c)

* Now we have a new server class (linux_server' and new deployement app that is assocaited with the server class.
* sample_app is associated with server class **linux_server** that is associated with all clients.

  ![image](https://github.com/user-attachments/assets/36a5c36c-cad7-48ff-a090-75b9f6f7baf7)

  
